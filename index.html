<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js"
      integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg=="
      crossorigin="anonymous"
    ></script>
    <!-- https://maps.googleapis.com/maps/api/geocode/json?latlng=${SEARCHING_lat},${SEARCHING_long}&key=${YOUR_GOOGLE_API_KEY} -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLiRARSvus-dp7-kMXYMXSpPh09mjXGGE"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
    <title>Weather App</title>
  </head>
  <body>
    <div id="background"></div>
    <center>
      <div id="wContainer">
        <h1>Weather</h1>
        <input
          type="text"
          id="cityName"
          placeholder="Enter City Name"
          autocomplete="off"
        />
        <input type="submit" id="getWeatherBtn" value="Get Weather" />
        <div id="output" class="out">
          <p class="city"></p>
          <div class="line"></div>
          <p class="temp"></p>
          <div class="details">
            <img class="icon" />
            <div class="detailsText">
              <p class="feelsLike"></p>
              <p class="humidity"></p>
            </div>
          </div>
          <p class="description"></p>
          <div class="line"></div>
          <p class="latLong"></p>
          <div id="showMap"></div>
        </div>
      </div>
    </center>
  </body>
  <script>
    var body = document.querySelector("body");
    var cityName = document.querySelector("#cityName");
    var getWeatherBtn = document.querySelector("#getWeatherBtn");
    var output = document.querySelector("#output");
    var bImgCon = document.querySelector("#background");
    // var bImg = document.createElement("img");

    var onload = () => {
      output.style.display = "none";
      bImgCon.style = "background-image: url('./images/weather2.jpeg')";
      bImgCon.classList.add("animateBg");
    };

    var getWeatherData = cityName => {
      const apiKey = "b3ddff3ed6d7680c73f7f66c51c30928";
      const baseUrl = "http://api.openweathermap.org/data/2.5/weather?q=";
      var apiUrl = `${baseUrl}${cityName}&appid=${apiKey}`;
      return axios.get(apiUrl);
    };

    function plotMap(lon, lat) {
      console.log(lon, lat);
      var latLong = { lat: lon, lng: lat };
      var mapOptions = {
        center: latLong,
        zoom: 4
      };
      // console.log(mapOptions);
      var map = new google.maps.Map(
        document.getElementById("showMap"),
        mapOptions
      );
      var marker = new google.maps.Marker({
        position: latLong,
        map: map,
        label: latLong.lat + "," + latLong.lng
      });
    }

    function getWeather(cityName) {
      var setEle = (ele, val) => {
        document.querySelector("." + ele).innerHTML = val;
      };

      getWeatherData(cityName)
        .then(response => {
          output.style.display = "block";
          output.style.backgroundColor = "rgba(197, 197, 197, 0.7)";

          // console.log(response.data);

          var apiData = response.data;
          var wCity = `${apiData.name} ( ${apiData.sys.country} )`;
          var wMain = apiData.weather[0].main.toLowerCase();
          var wDesc = apiData.weather[0].description;
          var wTemp = ((apiData.main.temp - 273.15) | 0) + `&deg; Celsius`;
          var wfeels = ((apiData.main.feels_like - 273.15) | 0) + `&deg; C`;
          var wHum = apiData.main.humidity;
          var wIcon = `http://openweathermap.org/img/w/${apiData.weather[0].icon}.png`;
          bImgCon.style = `background-image: url('./images/${wMain}.jpeg')`;
          bImgCon.classList.add("animateBg");
          setEle("city", wCity);
          setEle("temp", wTemp);
          setEle("feelsLike", `feels like ${wfeels}`);
          setEle("humidity", `humidity ~ ${wHum}%`);
          setEle("description", wDesc);
          document.querySelector(".icon").src = wIcon;
          plotMap(apiData.coord.lon, apiData.coord.lat);
        })
        .catch(error => {
          var wErr = error.response.data.message;
          alert(wErr + ": Please Enter a Valid City Name");
          location.reload();
        });
    }

    var reset = () => {
      cityName.value = "";
      cityName.focus();
    };

    document.addEventListener("DOMContentLoaded", () => {
      onload();
      reset();
      getWeatherBtn.addEventListener("click", () => {
        getWeather(cityName.value);
        reset();
      });
    });
  </script>
</html>
